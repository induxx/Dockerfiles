#!/bin/bash

GIT_REPO=induxx/akeneo-demo
CURRENT_DIR=$(pwd)

cd production/podman/akeneo/ak5

init_project()
{
    rm -rf app && mkdir -p app

    git clone git@github.com:${GIT_REPO}.git app

    cp .env.local app/.env.local

    cd app

    bash bin/init
    cd -
    rm -rf $( cat excluded_files.txt )
}

init_project

podman build -t induxx/cloud-akeneo:ak5 .

# ansible setup some stuff here like the scripts, cron

#podman push induxx/cloud-akeneo:ak5

rm -rf app

bash Jenkins_build

# extra commands to run after build

podman exec -it -u build -w /build/app ak5-pim-container bin/console d:s:c
podman exec -it -u build -w /build/app ak5-pim-container bin/console pim:installer:db --catalog vendor/akeneo/pim-community-dev/src/Akeneo/Platform/Bundle/InstallerBundle/Resources/fixtures/icecat_demo_dev
